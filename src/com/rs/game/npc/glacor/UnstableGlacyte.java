package com.rs.game.npc.glacor;import com.rs.game.Entity;import com.rs.game.Graphics;import com.rs.game.Hit;import com.rs.game.Hit.HitLook;//?lolimport com.rs.game.World;import com.rs.game.WorldTile;import com.rs.game.npc.NPC;import com.rs.game.npc.familiar.Familiar;import com.rs.game.npc.glacor.effect.UnstableEffect;import com.rs.game.player.Player;import com.rs.game.tasks.WorldTask;import com.rs.game.tasks.WorldTasksManager;import com.rs.utils.Utils;/** *  * @author Tyler *  */public class UnstableGlacyte extends NPC {	/**	 * 	 * Serial UID	 */	private static final long serialVersionUID = 5322103406609998421L;	private Entity target;	private long spawnTime;	private Glacor glacor;	private int attackDelay;	private boolean exploding;	private Effect effect;	private boolean isHealing;	private long healTime;	private final int EXPLODE_GFX = 956;	public UnstableGlacyte(Glacor glacor, WorldTile tile, Entity target) {		super(14302, tile, -1, true, true);		this.getCombat().setTarget(target);		this.setForceMultiArea(true);		this.setForceMultiAttacked(true);		this.glacor = glacor;		this.target = target;		this.spawnTime = Utils.currentTimeMillis();		this.effect = new UnstableEffect();	}	public boolean attackable(Entity target) {		return this.getCombat().getTarget() != null && target != null				&& getCombat().getTarget().getIndex() == target.getIndex();	}	private void explode() {		applyHit(new Hit(null, (int) (this.getHitpoints() * 0.90),				HitLook.REGULAR_DAMAGE));		exploding = false;		setNextGraphics(new Graphics(EXPLODE_GFX));		if (target == null)			return;		for (Entity entity : getPossibleTargets()) {			if (entity == null || this.isDead())				continue;			if (entity.withinDistance(this, 2)) {				entity.applyHit(new Hit(null,						(int) (target.getHitpoints() * 0.33),						HitLook.REGULAR_DAMAGE));			}		}	}	/**	 * 	 * @return the attackDelay	 */	public int getAttackDelay() {		return attackDelay;	}	/**	 * 	 * @return the effect	 */	public Effect getEffect() {		return effect;	}	public long getHealTime() {		return healTime;	}	public long getSpawnTime() {		return spawnTime;	}	public Player getTarget() {		return (Player) target;	}	public boolean isExploding() {		return exploding;	}	/**	 * 	 * @return the isHealing	 */	public boolean isHealing() {		return isHealing;	}	@Override	public void processNPC() {		super.processNPC();		target = this.getCombat().getTarget();		if (getHitpoints() <= 0 || isDead()) {			World.sendProjectile(this, glacor, 634, 34, 16, 30, 35, 16, 15);		}		if (spawnTime + 300000 < Utils.currentTimeMillis()				&& !this.getCombat().underCombat()) {			finish();		}		if ((this.getHitpoints() <= 500) && !isDead() && (getHitpoints() != 0)) {			this.heal(10);		}		if (this.getHitpoints() >= 500 && !exploding) {			exploding = true;			setSecondBar(new SecondBar(750));			WorldTasksManager.schedule(new WorldTask() {				@Override				public void run() {					explode();					stop();				}			}, 25, 0);		}		if (target != null) {			if (target instanceof Familiar) {				Familiar npc = (Familiar) target;				target = npc.getOwner();			}			if (target instanceof Player) {				if (target.isDead())					this.finish();			}		}	}	@Override	public void sendDeath(Entity target) {		if (glacor != null) {			if (glacor.getGlacytes().size() == 1) {				glacor.setEffect(GlacorEffect.UNSTABLE);			}			glacor.getGlacytes().remove(this);		}		super.sendDeath(target);	}	/**	 * 	 * @param attackDelay	 * 	 *            the attackDelay to set	 */	public void setAttackDelay(int attackDelay) {		this.attackDelay = attackDelay;	}	/**	 * 	 * @param effect	 * 	 *            the effect to set	 */	public void setEffect(Effect effect) {		this.effect = effect;	}	/**	 * 	 * @param isHealing	 * 	 *            the isHealing to set	 */	public void setHealing(boolean isHealing) {		this.isHealing = isHealing;	}	public void setHealTime(long healTime) {		this.healTime = healTime;	}	public void setSpawnTime(long spawnTime) {		this.spawnTime = spawnTime;	}	public void setTarget(Player target) {		this.target = target;	}}